<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen IP</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Sistem Manajemen IP WHM</h1>

        <div class="card">
            <h2>1. Cek Ketersediaan IP</h2>
            <form id="checkForm">
                <div class="form-group">
                    <label for="check-ip">IP Address:</label>
                    <input type="text" id="check-ip" name="ip" required>
                </div>
                <button type="submit">Cek IP</button>
            </form>
            <div id="check-message" class="message" style="display: none;"></div>
        </div>

        <div class="card">
            <h2>2. Registrasi IP</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="register-ip">IP Address:</label>
                    <input type="text" id="register-ip" name="ip" required>
                </div>
                <div class="form-group">
                    <label for="register-days">Masa Berlaku (hari):</label>
                    <input type="number" id="register-days" name="days" value="30" min="1" required>
                </div>
                <button type="submit">Daftarkan IP</button>
            </form>
            <div id="register-message" class="message" style="display: none;"></div>
        </div>

        <div class="card">
            <h2>3. Hapus IP (Manual)</h2>
            <form id="deleteForm">
                <div class="form-group">
                    <label for="delete-ip">IP Address:</label>
                    <input type="text" id="delete-ip" name="ip" required>
                </div>
                <button type="submit">Hapus IP</button>
            </form>
            <div id="delete-message" class="message" style="display: none;"></div>
        </div>
    </div>

    <script>
        const checkForm = document.getElementById('checkForm');
        const registerForm = document.getElementById('registerForm');
        const deleteForm = document.getElementById('deleteForm');

        async function submitForm(url, formId, messageId) {
            const form = document.getElementById(formId);
            const messageElement = document.getElementById(messageId);
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            messageElement.style.display = 'none';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                messageElement.style.display = 'block';
                if (response.ok) {
                    messageElement.textContent = result.message || 'Berhasil!';
                    messageElement.className = 'message success';
                } else {
                    messageElement.textContent = result.message || 'Terjadi kesalahan.';
                    messageElement.className = 'message error';
                }
            } catch (error) {
                messageElement.style.display = 'block';
                messageElement.textContent = 'Terjadi kesalahan pada koneksi.';
                messageElement.className = 'message error';
            }
        }

        checkForm.addEventListener('submit', (e) => {
            e.preventDefault();
            submitForm('/api/check', 'checkForm', 'check-message');
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            submitForm('/api/register', 'registerForm', 'register-message');
        });

        deleteForm.addEventListener('submit', (e) => {
            e.preventDefault();
            submitForm('/api/delete', 'deleteForm', 'delete-message');
        });
    </script>
</body>
</html>
